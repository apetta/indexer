import ContractOriginationHandler from './contract_origination';
import { originationsToEvents } from '../event-producer';
import { Originations } from '../../../types';

test('creates CONTRACT_ORIGINATION events', async () => {
  const originations: Originations = [
    {
      id: 457372699983872,
      nonce: 0,
      level: 3127113,
      timestamp: '2023-02-08T04:55:14Z',
      block: 'BMYFy5bu457tP9fzU82dv5tih72uG4ENNLX5FcXF2Huu1SYfbUV',
      counter: 68323805,
      hash: 'onr3kUkoLpjZtXEh36p6sJrYzzHHMZkNG8rXscfNvFyt1dHzXua',
      initiator: {
        address: 'tz1YWa3PRGZRipxYn5EfCZn5RQvUqmRwKmbZ',
      },
      sender: {
        alias: 'objkt.com Minting Factory',
        address: 'KT1Aq4wWmVanpQhq4TTfjZXB5AjFpx15iQMM',
      },
      status: 'applied',
      storage: {
        ledger: 379835,
        paused: false,
        metadata: 379836,
        operators: 379837,
        all_tokens: '0',
        total_supply: 379839,
        administrator: 'KT1Aq4wWmVanpQhq4TTfjZXB5AjFpx15iQMM',
        token_metadata: 379838,
      },
      originatedContract: {
        kind: 'asset',
        address: 'KT1FMasdf9h94fULdtLgSpauMVkNuTu8bELJ',
        typeHash: -213411401,
        codeHash: 199145999,
        tzips: ['fa2'],
      },
    },
    {
      id: 74231807213568,
      nonce: null,
      level: 1640824,
      timestamp: '2021-08-26T18:55:16Z',
      block: 'BMBzdggXDiMwwUNbrMezSQEFnPWgVoWwbr4KrTYsopiCBVbkVrG',
      counter: 23575945,
      hash: 'ooc4mPK7GWpFnvFY78qG9AZmPPQnpqUwMaaQf7zavq6QjucUFdQ',
      initiator: null,
      sender: {
        alias: 'objkt.com Treasury',
        address: 'tz1hFhmqKNB7hnHVHAFSk9wNqm7K9GgF2GDN',
      },
      status: 'applied',
      storage: {
        ledger: 12112,
        paused: false,
        metadata: 12113,
        operators: 12114,
        all_tokens: [],
        total_supply: 12116,
        administrator: 'KT1DdxmJujm3u2ZNkYwV24qLBJ6iR7sc58B9',
        token_metadata: 12115,
      },
      originatedContract: {
        kind: 'asset',
        alias: 'Tezzardz',
        address: 'KT1LHHLso8zQWQWg1HUukajdxxbkGfNoHjh6',
        typeHash: 558799600,
        codeHash: 1095391981,
        tzips: ['fa2'],
      },
    },

    {
      id: 466320837574656,
      nonce: null,
      level: 3156753,
      timestamp: '2023-02-18T14:19:44Z',
      block: 'BKnb5fgY2AAtNAQJuSDFzpjcqwFUgQubEczMDtr8HAHurcrKurv',
      counter: 71206502,
      hash: 'opZeHKdk7QKj6BoBhPS4x7DZDvZYHLLaQtuXFCsGBLb9aE3gMvh',
      initiator: null,
      sender: {
        address: 'tz1VnU46PBUG4KidZc78ZiXh1VtRgDzdWbkb',
      },
      status: 'applied',
      storage: {
        claims: 389404,
        ledger: 389405,
        locked: 389406,
        supply: 389410,
        claimed: 389403,
        managers: 389407,
        metadata: 389408,
        operators: 389409,
        administrator: 'tz1VnU46PBUG4KidZc78ZiXh1VtRgDzdWbkb',
        last_token_id: '0',
        token_metadata: 389411,
      },
      originatedContract: {
        kind: 'asset',
        address: 'KT1FD1mpxxuMZpbiU7WgiyDRrq9JU7vZEWfs',
        typeHash: 860155969,
        codeHash: 916104367,
        tzips: ['fa2'],
      },
    },

    {
      id: 512542083383296,
      nonce: null,
      level: 3318409,
      timestamp: '2023-04-07T11:33:09Z',
      block: 'BMXqkRZtXrKbKCwFdMvN7WfXAKKwXcmp57mkZTuRrdUetbwJmWP',
      counter: 33569152,
      hash: 'ooAJ6hf6PrcZGYmh67RqcRrM4vK5qy12wQJgvaMJhhdZPzTGJks',
      initiator: null,
      sender: {
        address: 'tz1XiHijLAdGXD9gHt33x5wGQEwVHyvznouS',
      },
      status: 'applied',
      storage: {
        claims: 424017,
        ledger: 424018,
        locked: 424019,
        supply: 424023,
        claimed: 424016,
        managers: 424020,
        metadata: 424021,
        operators: 424022,
        administrator: 'tz1XiHijLAdGXD9gHt33x5wGQEwVHyvznouS',
        last_token_id: '0',
        token_metadata: 424024,
      },
      originatedContract: {
        kind: 'asset',
        address: 'KT1NvUVGvZgfz1Rppnqo9hZDdEBQsVBQS7F9',
        typeHash: 860155969,
        codeHash: 916104367,
        tzips: ['fa2'],
      },
    },
    {
      id: 66599251869696,
      nonce: 9,
      level: 1586585,
      timestamp: '2021-08-04T12:47:46Z',
      block: 'BMRRVC9xF2fKEuBJAX7BJi1hXUEugy4VLiPN7R62LDK7fMT8zrh',
      counter: 11941258,
      hash: 'oo28JbSrWr7NMy95qdba56m85TcA2poJCgteB5DWUEMrZvC1B38',
      initiator: {
        alias: '1x1',
        address: 'tz1YJvMiZyXnzvV9pxtAiuCFvaG7XoBZhbUQ',
      },
      sender: {
        address: 'KT1DoyD6kr8yLK8mRBFusyKYJUk2ZxNHKP1N',
      },
      status: 'applied',
      storage: {
        shares: {
          tz1YJvMiZyXnzvV9pxtAiuCFvaG7XoBZhbUQ: '45000',
          tz1ZUohCAkGjp7vPjQcC4VWcpgYZR1t3Si5C: '5000',
          tz1eggoxCes1qYRGLc3E1bg4uzuCUUuuQBb9: '5000',
          tz2Hz4TVJZjoQVks4SfWgt38RfZTmrHmVH62: '45000',
        },
        isPaused: false,
        totalShares: '100000',
        tokenAddress: 'KT1RJ6PbjHpwc3M5rw5s2Nbmefwbuwbdxton',
        administrator: 'tz1YJvMiZyXnzvV9pxtAiuCFvaG7XoBZhbUQ',
        minterAddress: 'KT1Hkg5qeNhfwpKW4fXvq7HGZB9z2EnmCCA9',
        registryAddress: 'KT1My1wDZHDGweCrJnQJi3wcFaS67iksirvj',
        coreParticipants: ['tz1YJvMiZyXnzvV9pxtAiuCFvaG7XoBZhbUQ', 'tz2Hz4TVJZjoQVks4SfWgt38RfZTmrHmVH62'],
        marketplaceAddress: 'KT1HbQepzV1nVGg8QVznG7z4RcHseD5kwqBn',
        proposedAdministrator: null,
      },
      originatedContract: {
        kind: 'smart_contract',
        address: 'KT1K8A2cqqpQTEHYpY9R7aAybCdcM3tNpXyu',
        typeHash: 1449840799,
        codeHash: -1760376355,
      },
    },
  ];

  const events = originationsToEvents(originations, [ContractOriginationHandler]);

  expect(events).toStrictEqual([
    {
      id: 'bd962a9a27ca682335043da2b93faa40',
      type: 'CONTRACT_ORIGINATION',
      opid: '457372699983872',
      ophash: 'onr3kUkoLpjZtXEh36p6sJrYzzHHMZkNG8rXscfNvFyt1dHzXua',
      timestamp: '2023-02-08T04:55:14Z',
      level: 3127113,
      contract_address: 'KT1FMasdf9h94fULdtLgSpauMVkNuTu8bELJ',
      initiator_address: 'tz1YWa3PRGZRipxYn5EfCZn5RQvUqmRwKmbZ',
      sender_address: 'KT1Aq4wWmVanpQhq4TTfjZXB5AjFpx15iQMM',
      code_hash: 199145999,
      type_hash: -213411401,
    },
    {
      code_hash: 1095391981,
      contract_address: 'KT1LHHLso8zQWQWg1HUukajdxxbkGfNoHjh6',
      id: '8777d7eb96bf409f39022982cf6f5599',
      level: 1640824,
      ophash: 'ooc4mPK7GWpFnvFY78qG9AZmPPQnpqUwMaaQf7zavq6QjucUFdQ',
      opid: '74231807213568',
      sender_address: 'tz1hFhmqKNB7hnHVHAFSk9wNqm7K9GgF2GDN',
      timestamp: '2021-08-26T18:55:16Z',
      type: 'CONTRACT_ORIGINATION',
      type_hash: 558799600,
    },
    {
      code_hash: 916104367,
      contract_address: 'KT1FD1mpxxuMZpbiU7WgiyDRrq9JU7vZEWfs',
      id: 'cf32ec6484940c39b6d6c57890317cc3',
      level: 3156753,
      ophash: 'opZeHKdk7QKj6BoBhPS4x7DZDvZYHLLaQtuXFCsGBLb9aE3gMvh',
      opid: '466320837574656',
      sender_address: 'tz1VnU46PBUG4KidZc78ZiXh1VtRgDzdWbkb',
      timestamp: '2023-02-18T14:19:44Z',
      type: 'CONTRACT_ORIGINATION',
      type_hash: 860155969,
    },
    {
      code_hash: 916104367,
      contract_address: 'KT1NvUVGvZgfz1Rppnqo9hZDdEBQsVBQS7F9',
      id: '0ad62d866ed7d3de1165f17e36c31331',
      level: 3318409,
      ophash: 'ooAJ6hf6PrcZGYmh67RqcRrM4vK5qy12wQJgvaMJhhdZPzTGJks',
      opid: '512542083383296',
      sender_address: 'tz1XiHijLAdGXD9gHt33x5wGQEwVHyvznouS',
      timestamp: '2023-04-07T11:33:09Z',
      type: 'CONTRACT_ORIGINATION',
      type_hash: 860155969,
    },
    {
      code_hash: -1760376355,
      contract_address: 'KT1K8A2cqqpQTEHYpY9R7aAybCdcM3tNpXyu',
      id: '683b27cc1b3471e79f9ba04b76cee131',
      initiator_address: 'tz1YJvMiZyXnzvV9pxtAiuCFvaG7XoBZhbUQ',
      level: 1586585,
      ophash: 'oo28JbSrWr7NMy95qdba56m85TcA2poJCgteB5DWUEMrZvC1B38',
      opid: '66599251869696',
      sender_address: 'KT1DoyD6kr8yLK8mRBFusyKYJUk2ZxNHKP1N',
      timestamp: '2021-08-04T12:47:46Z',
      type: 'CONTRACT_ORIGINATION',
      type_hash: 1449840799,
    },
  ]);
});
